<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kurumi.mapper.MedicalOfficeMapper">
  <resultMap id="medicalOffice" type="com.kurumi.pojo.MedicalOffice">
     <id column="id" property="id" jdbcType="INTEGER" />
    <result column="code" property="code" jdbcType="VARCHAR" />
     <result column="index_code" property="indexCode" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
     <result column="en_name" property="enName" jdbcType="VARCHAR" />
      <result column="comment" property="comment" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="hospital_id" property="hospitalId" jdbcType="INTEGER" />
  </resultMap>
 
 <!-- 根据条件获取科室信息 -->
   <select id="getMedicalOffices" resultType="map" parameterType="com.kurumi.query.BasicDataQuery">
  	select med.id, med.code, med.name, med.index_code indexCode,med.en_name enName,med.comment,med.status,med.hospital_id,hp.name hospitalName from medical_office med left join hospital hp on med.hospital_id=hp.id where 1=1
  	<if test="name!=null">
  	 	and med.name=#{name}
  	</if>
  	 <if test="hospitalId != null">
  	 	and hp.id=#{hospitalId}
  	</if>
  	 order by med.id desc
  	 limit #{currentStartNum},#{pageSize}
  </select>
  
    <!-- 根据条件获取科室数量 -->
   <select id="getCountByParams" parameterType="com.kurumi.query.BasicDataQuery" resultType="java.lang.Integer">
  	select count(*) from medical_office med left join hospital hp on med.hospital_id=hp.id where 1=1
  	<if test="name!=null">
  	 	and med.name=#{name}
  	</if>
  	 <if test="hospitalId != null">
  	 	and hp.id=#{hospitalId}
  	</if>
  </select>
  
   <select id="selectByPrimaryKey" resultType="medicalOffice" parameterType="java.lang.Integer">
  	  	select med.id, med.code, med.name, med.index_code indexCode,med.en_name enName,med.comment,med.status,med.hospital_id hospitalId,hp.name hospitalName from medical_office med left join hospital hp on med.hospital_id=hp.id where med.id=#{id}
  </select>
  <insert id="insertMedicalOffice" parameterType="medicalOffice" >
  	insert into medical_office
  	  <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="code != null" >
        code,
      </if>
      <if test="indexCode != null" >
        index_code,
      </if>
      <if test="name != null" >
        name,
      </if>
      <if test="enName != null" >
        en_name,
      </if>
      <if test="comment != null" >
        comment,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="hospitalId != null" >
        hospital_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="code != null" >
        #{code,jdbcType=VARCHAR},
      </if>
       <if test="indexCode != null" >
         #{indexCode,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="enName != null" >
         #{enName,jdbcType=VARCHAR},
      </if>
      <if test="comment != null" >
         #{comment,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="hospitalId != null" >
        #{hospitalId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  
  <update id="updateByPrimaryKey" parameterType="medicalOffice" >
    update medical_office
    <set >
      <if test="code != null" >
        code = #{code,jdbcType=VARCHAR},
      </if>
      <if test="indexCode != null" >
        index_code = #{indexCode,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
       <if test="enName != null" >
         en_name=#{enName,jdbcType=VARCHAR},
      </if>
      <if test="comment != null" >
         comment=#{comment,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
       <if test="hospitalId != null" >
        hospital_id = #{hospitalId,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>

 <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
      delete from medical_office where id=#{id}
  </delete>
  
  <select id="validateIsUse" parameterType="java.lang.Integer" resultType="java.lang.Integer">
  	select count(*) from hospitalization_note where 1=1
  	<if test="_parameter !=null and _parameter !='' ">
  	 	and (in_dept_id=#{id} or out_dept_id=#{id})
  	</if>
  </select>
</mapper>